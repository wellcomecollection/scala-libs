Simplify error handling in http lib, add some tests for WellcomeHttpApp
